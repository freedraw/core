var h = require('fd/html')
var Node = require('./node')

function Tree(editor) {
  this.editor = editor

  this.el = h('.tree panel', [
    h('.panel-header'),
    this.content = h('.panel-content'),
    h('.panel-footer'),
  ])

  editor.on('documentChange', this.onDocumentChange, this)
  this.onDocumentChange()
}

Tree.prototype.onDocumentChange = function() {
  // if (this.document) this.document.unlisten('structuralChange', )
  this.document = this.editor.document
  this.reload()
}

Tree.prototype.reload = function() {
  if (this.nodes) {
    for (var i = this.nodes.length; i--;) {
      this.nodes[i].detach()
    }
  }
  this.nodes = []
  for (var children = this.document.children, i = 0, l = children.length; i < l; i++) {
    var n = new Node(this, children[i])
    this.content.appendChild(n.el)
    this.nodes.push(n)
  }
}

module.exports = Tree
