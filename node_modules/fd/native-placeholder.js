var keyBindings = require('fd/key-bindings')
var platform = require('fd/platform')

exports.done = function() {
  exports.hooks.loadData('public.svg-image', '<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"> <svg xmlns="http://www.w3.org/2000/svg"> <g transform="translate(200,200)"> <circle cx="0" cy="0" r="30" style="fill: #ff0000; stroke: #000000; stroke-width: 2px;"/> <g transform="rotate(30) translate(30,-100) scale(.5,2)"> <ellipse cx="19.0718" cy="37.8422" rx="60" ry="72.7655" style="fill: #ffff00; stroke: #000000; stroke-width: 1px;"/> <rect x="-230" y="90" width="160" height="40" style="fill: #ff69b4; stroke: #000000; stroke-width: 2px;"/> </g> </g> </svg>')
}

exports.hooks = {
  runCommand: function() {},
  getData: function() {},
  loadData: function() {}
}

document.addEventListener('keydown', function(e) {
  var t = document.activeElement
  if (t && t.tagName !== 'BODY' && !e.altKey && !e.ctrlKey && !e.metaKey) {
    return
  }

  var id = e.keyIdentifier.slice(0, 2) === 'U+' ? String.fromCharCode(parseInt(e.keyIdentifier.slice(2), 16)) : e.keyIdentifier
  var stroke = (e.ctrlKey ? '^' : '') + (e.altKey ? ':' : '') + (e.shiftKey ? '!' : '') + ((platform.isOSX ? e.metaKey : e.ctrlKey) ? '#' : '') + id

  var binding = keyBindings[stroke]
  if (!binding) return

  var results = exports.hooks.runCommand(binding)
  if (results.length > 0 && results.some(function(x) {return !x})) {
    e.preventDefault()
  }
})
